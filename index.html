<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>e-Bridge - eSports Performance Bridge</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="alternate icon" href="favicon.ico">
    <link rel="apple-touch-icon" href="favicon.svg">
    
    <link rel="stylesheet" href="styles.css">
    <!-- SweetAlert2 for rich confirmation dialogs -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="player-stats.js"></script>
</head>
<body>
    <div id="app" class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <h1>e-Bridge</h1>
                </div>
                <nav class="nav">
                    <button class="nav-btn active" data-page="dashboard">
                        <span class="nav-icon">📊</span>
                        ダッシュボード
                    </button>
                    <button class="nav-btn" data-page="analysis">
                        <span class="nav-icon">📈</span>
                        分析
                    </button>
                    <button class="nav-btn" data-page="gallery">
                        <span class="nav-icon">🖼️</span>
                        ギャラリー
                    </button>
                    <button class="nav-btn" data-page="ai-chat">
                        <span class="nav-icon">🤖</span>
                        AIチャット
                    </button>
                    <button class="nav-btn" data-page="goals">
                        <span class="nav-icon">🎯</span>
                        目標
                    </button>
                    <button class="nav-btn" data-page="coaching-plans">
                        <span class="nav-icon">📋</span>
                        コーチングプラン
                    </button>
                    <button class="nav-btn" data-page="data-source">
                        <span class="nav-icon">📁</span>
                        データソース
                    </button>
                    <button class="nav-btn" data-page="settings">
                        <span class="nav-icon">⚙️</span>
                        設定
                    </button>
                </nav>
                <div class="user-actions">
                    <div class="user-status" id="user-status">
                        <span class="user-name" id="header-user-name">ゲストユーザー</span>
                        <span class="user-type" id="user-type-indicator">ゲスト</span>
                    </div>
                    <div class="theme-toggle">
                        <button id="theme-toggle-btn" class="theme-btn">🌙</button>
                    </div>
                    <div class="user-menu">
                        <button id="logout-btn" class="logout-btn" title="ログアウト">👤</button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Page -->
            <div id="dashboard" class="page active">
                <div class="page-header">
                    <h2>🎯 VALORANT ダッシュボード</h2>
                    <p>VALORANT プレイヤーパフォーマンス概要</p>
                </div>

                <!-- Win Streak Display -->
                <div class="win-streak-banner" id="win-streak-banner">
                    <div class="streak-content">
                        <span class="streak-icon">🔥</span>
                        <div class="streak-info">
                            <span class="streak-label">現在の連勝</span>
                            <span class="streak-value" id="current-win-streak">0</span>
                            <span class="streak-unit">連勝</span>
                        </div>
                    </div>
                </div>

                <!-- Performance Charts -->
                <div class="charts-grid">
                    <div class="card chart-card">
                        <div class="chart-header">
                            <h3>勝率トレンド</h3>
                            <button class="btn-text" id="show-winrate-detail-btn" title="詳細を表示">
                                📊 詳しく見る
                            </button>
                        </div>
                        <canvas id="performance-chart"></canvas>
                    </div>
                    <div class="card chart-card">
                        <h3>エージェント使用率</h3>
                        <canvas id="valorant-metrics-chart"></canvas>
                    </div>
                </div>

                <!-- Recent Matches -->
                <div class="card">
                    <h3>最近の試合結果</h3>
                    <div id="recent-matches" class="matches-list">
                        <div class="no-matches-message">
                            <p class="message-text">まだ試合データがありません</p>
                            <p class="message-sub">分析タブから試合結果を入力してください</p>
                            <button class="btn-secondary" id="goto-analysis">
                                試合データを入力する →
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Daily Coaching Card -->
                <div class="card coaching-card" id="daily-coaching-card">
                    <div class="coaching-header">
                        <h3>🎯 今日のコーチング</h3>
                        <div class="coaching-header-actions">
                            <button id="history-button" class="btn-text history-btn">📜 履歴</button>
                            <span class="coaching-date" id="coaching-date">今日</span>
                        </div>
                    </div>

                    <div class="coaching-content" id="coaching-content">
                        <div class="coaching-headline">
                            <h4 id="coaching-headline">コーチングを準備中...</h4>
                        </div>

                        <div class="coaching-core-content">
                            <p id="coaching-core-content">ゲームを選択してスキルレベルを設定すると、パーソナライズされたコーチングアドバイスが表示されます。</p>
                        </div>

                        <div class="coaching-practical-step">
                            <div class="step-label">今日試してみよう</div>
                            <p id="coaching-practical-step">設定を完了して、今日のアドバイスを受け取りましょう！</p>
                        </div>

                        <!-- Goal Connection (目標との関連) -->
                        <div class="coaching-goal-connection" id="coaching-goal-connection-container" style="display: none;">
                            <div class="goal-connection-label">🎯 目標達成への貢献</div>
                            <p id="coaching-goal-connection">目標達成への関連性が表示されます</p>
                        </div>
                    </div>

                    <div class="coaching-actions">
                        <div class="coaching-feedback" id="coaching-feedback">
                            <span class="feedback-label">このアドバイスは役に立ちましたか？</span>
                            <div class="feedback-buttons">
                                <button class="feedback-btn helpful" data-feedback="helpful">
                                    👍 役に立った
                                </button>
                                <button class="feedback-btn easy" data-feedback="too_easy">
                                    😊 簡単すぎた
                                </button>
                                <button class="feedback-btn hard" data-feedback="too_hard">
                                    😅 難しすぎた
                                </button>
                            </div>

                            <!-- コメント機能エリア -->
                            <div class="feedback-comment-section" id="feedback-comment-section" style="display: none;">
                                <div class="comment-header">
                                    <label for="feedback-comment">💬 詳細なフィードバック（任意）</label>
                                    <span class="comment-helper">明日のコーチングに反映されます</span>
                                </div>
                                <textarea
                                    id="feedback-comment"
                                    placeholder="例：エイム練習をもっと詳しく教えて欲しい、戦略的な判断について学びたい、など具体的な要望を入力してください"
                                    rows="3"
                                    maxlength="500"></textarea>
                                <div class="comment-actions">
                                    <button class="submit-feedback-btn" id="submit-feedback-btn" disabled>
                                        フィードバックを送信
                                    </button>
                                    <button class="cancel-feedback-btn" id="cancel-feedback-btn">
                                        キャンセル
                                    </button>
                                </div>
                                <div class="comment-counter">
                                    <span id="comment-char-count">0</span>/500文字
                                </div>
                            </div>
                        </div>

                        <div class="coaching-progress" id="coaching-progress">
                            <div class="progress-stats">
                                <div class="stat">
                                    <span class="stat-value" id="continuous-days">0</span>
                                    <span class="stat-label">日継続</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-value" id="total-lessons">0</span>
                                    <span class="stat-label">レッスン完了</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dashboard Goals -->
                <div class="card dashboard-goals" id="dashboard-goals">
                    <div class="goals-header">
                        <h3>🎯 現在の目標</h3>
                        <button class="view-all-goals" id="view-all-goals">すべて見る</button>
                    </div>
                    <div class="dashboard-goals-list" id="dashboard-goals-list">
                        <div class="no-goals-message">
                            <h4>目標が設定されていません</h4>
                            <p>パフォーマンス向上のための目標を設定しましょう</p>
                            <button class="add-goal-btn" id="add-first-goal">最初の目標を追加</button>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Analysis Page -->
            <div id="analysis" class="page">
                <div class="page-header">
                    <h2>🎯 VALORANT 試合分析</h2>
                    <p>VALORANTの試合データ入力と対戦分析</p>
                </div>

                <!-- Quick Match Input -->
                <div class="card quick-match-card">
                    <h3>🥊 かんたん試合入力</h3>
                    <p class="subtitle">数タップで試合結果を素早く記録</p>
                    <form id="quick-match-form" class="quick-match-form">
                        <!-- Character Selection Row -->
                        <div class="match-section character-section">
                            <h4>使用キャラクター</h4>
                            <div class="character-filter">
                                <input type="text" id="player-character-search" placeholder="キャラクター名で検索..." class="character-search-input">
                                <span class="search-icon">🔍</span>
                            </div>
                            <div class="character-grid" id="player-character-grid">
                                <div class="char-option" data-char="Luke">
                                    <div class="char-icon">👊</div>
                                    <span class="char-name">Luke</span>
                                </div>
                                <div class="char-option" data-char="Ryu">
                                    <div class="char-icon">🥋</div>
                                    <span class="char-name">Ryu</span>
                                </div>
                                <div class="char-option" data-char="Ken">
                                    <div class="char-icon">🔥</div>
                                    <span class="char-name">Ken</span>
                                </div>
                                <div class="char-option" data-char="Chun-Li">
                                    <div class="char-icon">💨</div>
                                    <span class="char-name">Chun-Li</span>
                                </div>
                                <div class="char-option" data-char="Cammy">
                                    <div class="char-icon">⚡</div>
                                    <span class="char-name">Cammy</span>
                                </div>
                                <div class="char-option" data-char="Zangief">
                                    <div class="char-icon">💪</div>
                                    <span class="char-name">Zangief</span>
                                </div>
                                <div class="char-option" data-char="JP">
                                    <div class="char-icon">🎭</div>
                                    <span class="char-name">JP</span>
                                </div>
                                <div class="char-option" data-char="Juri">
                                    <div class="char-icon">👁️</div>
                                    <span class="char-name">Juri</span>
                                </div>
                                <div class="char-option" data-char="Kimberly">
                                    <div class="char-icon">🌪️</div>
                                    <span class="char-name">Kimberly</span>
                                </div>
                                <div class="char-option" data-char="Lily">
                                    <div class="char-icon">🌸</div>
                                    <span class="char-name">Lily</span>
                                </div>
                                <div class="char-option" data-char="Manon">
                                    <div class="char-icon">🎭</div>
                                    <span class="char-name">Manon</span>
                                </div>
                                <div class="char-option" data-char="Marisa">
                                    <div class="char-icon">🛡️</div>
                                    <span class="char-name">Marisa</span>
                                </div>
                                <div class="char-option" data-char="Jamie">
                                    <div class="char-icon">🍷</div>
                                    <span class="char-name">Jamie</span>
                                </div>
                                <div class="char-option" data-char="Dhalsim">
                                    <div class="char-icon">🧘</div>
                                    <span class="char-name">Dhalsim</span>
                                </div>
                                <div class="char-option" data-char="E.Honda">
                                    <div class="char-icon">🍣</div>
                                    <span class="char-name">E.Honda</span>
                                </div>
                                <div class="char-option" data-char="Blanka">
                                    <div class="char-icon">⚡</div>
                                    <span class="char-name">Blanka</span>
                                </div>
                                <div class="char-option" data-char="Guile">
                                    <div class="char-icon">🪖</div>
                                    <span class="char-name">Guile</span>
                                </div>
                                <div class="char-option" data-char="Dee Jay">
                                    <div class="char-icon">🎵</div>
                                    <span class="char-name">Dee Jay</span>
                                </div>
                                <div class="char-option" data-char="ラシード">
                                    <div class="char-icon">🌪️</div>
                                    <span class="char-name">ラシード</span>
                                </div>
                                <div class="char-option" data-char="A.K.I.">
                                    <div class="char-icon">🐍</div>
                                    <span class="char-name">A.K.I.</span>
                                </div>
                                <div class="char-option" data-char="エド">
                                    <div class="char-icon">⚡</div>
                                    <span class="char-name">エド</span>
                                </div>
                                <div class="char-option" data-char="豪鬼">
                                    <div class="char-icon">👹</div>
                                    <span class="char-name">豪鬼</span>
                                </div>
                                <div class="char-option" data-char="ベガ">
                                    <div class="char-icon">👑</div>
                                    <span class="char-name">ベガ</span>
                                </div>
                                <div class="char-option" data-char="テリー・ボガード">
                                    <div class="char-icon">🥊</div>
                                    <span class="char-name">テリー・ボガード</span>
                                </div>
                                <div class="char-option" data-char="不知火 舞">
                                    <div class="char-icon">🌸</div>
                                    <span class="char-name">不知火 舞</span>
                                </div>
                                <div class="char-option" data-char="エレナ">
                                    <div class="char-icon">🌿</div>
                                    <span class="char-name">エレナ</span>
                                </div>
                                <div class="char-option" data-char="サガット">
                                    <div class="char-icon">🐅</div>
                                    <span class="char-name">サガット</span>
                                </div>
                                <div class="char-option" data-char="C.ヴァイパー">
                                    <div class="char-icon">⚙️</div>
                                    <span class="char-name">C.ヴァイパー</span>
                                </div>
                                <div class="char-option" data-char="アレックス">
                                    <div class="char-icon">💪</div>
                                    <span class="char-name">アレックス</span>
                                </div>
                                <div class="char-option" data-char="イングリッド">
                                    <div class="char-icon">🌠</div>
                                    <span class="char-name">イングリッド</span>
                                </div>
                            </div>
                        </div>

                        <!-- VS Section -->
                        <div class="vs-section">
                            <div class="vs-label">VS</div>
                        </div>

                        <!-- Opponent Character Selection -->
                        <div class="match-section opponent-section">
                            <h4>相手キャラクター</h4>
                            <div class="character-filter">
                                <input type="text" id="opponent-character-search" placeholder="相手キャラクター名で検索..." class="character-search-input">
                                <span class="search-icon">🔍</span>
                            </div>
                            <div class="character-grid" id="opponent-character-grid">
                                <div class="char-option opponent-char" data-char="Luke">
                                    <div class="char-icon">👊</div>
                                    <span class="char-name">Luke</span>
                                </div>
                                <div class="char-option opponent-char" data-char="Ryu">
                                    <div class="char-icon">🥋</div>
                                    <span class="char-name">Ryu</span>
                                </div>
                                <div class="char-option opponent-char" data-char="Ken">
                                    <div class="char-icon">🔥</div>
                                    <span class="char-name">Ken</span>
                                </div>
                                <div class="char-option opponent-char" data-char="Chun-Li">
                                    <div class="char-icon">💨</div>
                                    <span class="char-name">Chun-Li</span>
                                </div>
                                <div class="char-option opponent-char" data-char="Cammy">
                                    <div class="char-icon">⚡</div>
                                    <span class="char-name">Cammy</span>
                                </div>
                                <div class="char-option opponent-char" data-char="Zangief">
                                    <div class="char-icon">💪</div>
                                    <span class="char-name">Zangief</span>
                                </div>
                                <div class="char-option opponent-char" data-char="JP">
                                    <div class="char-icon">🎭</div>
                                    <span class="char-name">JP</span>
                                </div>
                                <div class="char-option opponent-char" data-char="Juri">
                                    <div class="char-icon">👁️</div>
                                    <span class="char-name">Juri</span>
                                </div>
                                <div class="char-option opponent-char" data-char="Kimberly">
                                    <div class="char-icon">🌪️</div>
                                    <span class="char-name">Kimberly</span>
                                </div>
                                <div class="char-option opponent-char" data-char="Lily">
                                    <div class="char-icon">🌸</div>
                                    <span class="char-name">Lily</span>
                                </div>
                                <div class="char-option opponent-char" data-char="Manon">
                                    <div class="char-icon">🎭</div>
                                    <span class="char-name">Manon</span>
                                </div>
                                <div class="char-option opponent-char" data-char="Marisa">
                                    <div class="char-icon">🛡️</div>
                                    <span class="char-name">Marisa</span>
                                </div>
                                <div class="char-option opponent-char" data-char="Jamie">
                                    <div class="char-icon">🍷</div>
                                    <span class="char-name">Jamie</span>
                                </div>
                                <div class="char-option opponent-char" data-char="Dhalsim">
                                    <div class="char-icon">🧘</div>
                                    <span class="char-name">Dhalsim</span>
                                </div>
                                <div class="char-option opponent-char" data-char="E.Honda">
                                    <div class="char-icon">🍣</div>
                                    <span class="char-name">E.Honda</span>
                                </div>
                                <div class="char-option opponent-char" data-char="Blanka">
                                    <div class="char-icon">⚡</div>
                                    <span class="char-name">Blanka</span>
                                </div>
                                <div class="char-option opponent-char" data-char="Guile">
                                    <div class="char-icon">🪖</div>
                                    <span class="char-name">Guile</span>
                                </div>
                                <div class="char-option opponent-char" data-char="Dee Jay">
                                    <div class="char-icon">🎵</div>
                                    <span class="char-name">Dee Jay</span>
                                </div>
                                <div class="char-option opponent-char" data-char="ラシード">
                                    <div class="char-icon">🌪️</div>
                                    <span class="char-name">ラシード</span>
                                </div>
                                <div class="char-option opponent-char" data-char="A.K.I.">
                                    <div class="char-icon">🐍</div>
                                    <span class="char-name">A.K.I.</span>
                                </div>
                                <div class="char-option opponent-char" data-char="エド">
                                    <div class="char-icon">⚡</div>
                                    <span class="char-name">エド</span>
                                </div>
                                <div class="char-option opponent-char" data-char="豪鬼">
                                    <div class="char-icon">👹</div>
                                    <span class="char-name">豪鬼</span>
                                </div>
                                <div class="char-option opponent-char" data-char="ベガ">
                                    <div class="char-icon">👑</div>
                                    <span class="char-name">ベガ</span>
                                </div>
                                <div class="char-option opponent-char" data-char="テリー・ボガード">
                                    <div class="char-icon">🥊</div>
                                    <span class="char-name">テリー・ボガード</span>
                                </div>
                                <div class="char-option opponent-char" data-char="不知火 舞">
                                    <div class="char-icon">🌸</div>
                                    <span class="char-name">不知火 舞</span>
                                </div>
                                <div class="char-option opponent-char" data-char="エレナ">
                                    <div class="char-icon">🌿</div>
                                    <span class="char-name">エレナ</span>
                                </div>
                                <div class="char-option opponent-char" data-char="サガット">
                                    <div class="char-icon">🐅</div>
                                    <span class="char-name">サガット</span>
                                </div>
                                <div class="char-option opponent-char" data-char="C.ヴァイパー">
                                    <div class="char-icon">⚙️</div>
                                    <span class="char-name">C.ヴァイパー</span>
                                </div>
                                <div class="char-option opponent-char" data-char="アレックス">
                                    <div class="char-icon">💪</div>
                                    <span class="char-name">アレックス</span>
                                </div>
                                <div class="char-option opponent-char" data-char="イングリッド">
                                    <div class="char-icon">🌠</div>
                                    <span class="char-name">イングリッド</span>
                                </div>
                            </div>
                        </div>

                        <!-- Match Score Section -->
                        <div class="match-section score-section">
                            <h4>試合結果</h4>
                            <div class="score-grid">
                                <div class="score-option" data-score="2-0" data-result="win">
                                    <div class="score-display">2-0</div>
                                    <div class="score-label">完勝</div>
                                </div>
                                <div class="score-option" data-score="2-1" data-result="win">
                                    <div class="score-display">2-1</div>
                                    <div class="score-label">勝利</div>
                                </div>
                                <div class="score-option" data-score="1-1" data-result="draw">
                                    <div class="score-display">1-1</div>
                                    <div class="score-label">引き分け</div>
                                </div>
                                <div class="score-option" data-score="1-2" data-result="loss">
                                    <div class="score-display">1-2</div>
                                    <div class="score-label">敗北</div>
                                </div>
                                <div class="score-option" data-score="0-2" data-result="loss">
                                    <div class="score-display">0-2</div>
                                    <div class="score-label">完敗</div>
                                </div>
                            </div>
                        </div>

                        <!-- Final Round Decision -->
                        <div class="match-section decision-section">
                            <h4>最終ラウンドの決着方法</h4>
                            <div class="decision-grid">
                                <div class="decision-option" data-decision="ko">
                                    <div class="decision-icon">💥</div>
                                    <span>KO</span>
                                </div>
                                <div class="decision-option" data-decision="timeout">
                                    <div class="decision-icon">⏰</div>
                                    <span>タイムアップ</span>
                                </div>
                                <div class="decision-option" data-decision="perfect">
                                    <div class="decision-icon">✨</div>
                                    <span>パーフェクト</span>
                                </div>
                                <div class="decision-option" data-decision="super">
                                    <div class="decision-icon">🌟</div>
                                    <span>スーパーアーツ</span>
                                </div>
                                <div class="decision-option" data-decision="critical">
                                    <div class="decision-icon">💎</div>
                                    <span>クリティカルアーツ</span>
                                </div>
                                <div class="decision-option" data-decision="drive-impact">
                                    <div class="decision-icon">🚀</div>
                                    <span>ドライブインパクト</span>
                                </div>
                            </div>
                        </div>

                        <!-- Insight Tags Section -->
                        <div class="match-section insight-section">
                            <h4>💭 試合の気づき（任意）</h4>
                            <p class="subtitle">感じたことを入力すると、AIが分析タグを生成します</p>

                            <!-- Analysis Source Selection -->
                            <div class="analysis-source-selector">
                                <h5>情報ソースを選択</h5>
                                <div class="radio-group">
                                    <label class="radio-label">
                                        <input type="radio" name="analysis-source" value="browsing" checked>
                                        <span>🌐 ブラウジング</span>
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="analysis-source" value="file" id="source-file-radio" disabled>
                                        <span>📁 アップロードしたファイル</span>
                                    </label>
                                </div>
                                <div id="source-file-selector-container" style="display: none; margin-top: 10px;">
                                    <div id="source-file-list" class="source-file-list"></div>
                                </div>
                            </div>

                            <div class="insight-input-wrapper">
                                <textarea
                                    id="match-feelings"
                                    name="feelings"
                                    placeholder="例：相手の飛び込みに対空が間に合わなかった、コンボをドロップしてしまった、読み合いで勝てた瞬間があった..."
                                    rows="3"
                                    maxlength="300"></textarea>
                                <div class="insight-actions">
                                    <button type="button" id="generate-tags-btn" class="btn-secondary" disabled>
                                        🤖 AIでタグ生成
                                    </button>
                                    <span class="char-counter">
                                        <span id="feelings-char-count">0</span>/300文字
                                    </span>
                                </div>
                            </div>

                            <!-- Generated Tags Display -->
                            <div class="generated-tags-container" id="generated-tags-container" style="display: none;">
                                <div class="tags-header">
                                    <h5>🏷️ 生成されたタグ</h5>
                                    <button type="button" id="regenerate-tags-btn" class="btn-text" title="タグを再生成">
                                        🔄
                                    </button>
                                </div>
                                <div class="tags-list" id="generated-tags-list">
                                    <!-- タグがここに表示される -->
                                </div>
                                <div class="tags-actions">
                                    <button type="button" id="accept-tags-btn" class="btn-primary">
                                        ✅ これらのタグを使用
                                    </button>
                                    <button type="button" id="clear-tags-btn" class="btn-secondary">
                                        ❌ クリア
                                    </button>
                                </div>
                            </div>

                            <!-- Final Tags Display -->
                            <div class="final-tags-container" id="final-tags-container" style="display: none;">
                                <div class="final-tags-header">
                                    <h5>📌 記録するタグ</h5>
                                    <button type="button" id="edit-tags-btn" class="btn-text">
                                        ✏️ 編集
                                    </button>
                                </div>
                                <div class="final-tags-list" id="final-tags-list">
                                    <!-- 最終確定されたタグがここに表示される -->
                                </div>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="form-actions">
                            <button type="submit" class="btn-primary quick-submit-btn" disabled>
                                📊 試合を記録
                            </button>
                            <button type="button" class="btn-secondary" id="reset-quick-form">
                                🔄 リセット
                            </button>
                        </div>

                        <!-- Hidden inputs for form data -->
                        <input type="hidden" id="selected-character" name="character">
                        <input type="hidden" id="selected-opponent" name="opponent">
                        <input type="hidden" id="selected-score" name="score">
                        <input type="hidden" id="selected-result" name="result">
                        <input type="hidden" id="selected-decision" name="decision">
                        <input type="hidden" id="selected-tags" name="insightTags">
                        <input type="hidden" id="match-feelings-hidden" name="feelings">
                    </form>
                </div>

                <!-- Batch Match Input (Screenshot Upload) -->
                <div class="card batch-match-card">
                    <h3>📸 まとめて入力（スクリーンショット）</h3>
                    <p class="subtitle">戦績画面のスクリーンショットをアップロードして、複数の対戦データを一括で入力</p>
                    
                    <div class="batch-upload-area">
                        <div class="upload-instructions">
                            <h4>📋 使い方</h4>
                            <ol>
                                <li>VALORANTの戦績画面のスクリーンショットを撮影</li>
                                <li>下のボタンから画像ファイルを選択</li>
                                <li>AIが自動的にエージェント別の試合数と勝率を抽出</li>
                                <li>データを確認して保存</li>
                            </ol>
                            <p class="note">※ 現在、VALORANT向けには利用できません。個別入力をご利用ください。</p>
                        </div>

                        <!--<div class="upload-section">
                            <input type="file" id="batch-screenshot-input" accept="image/*" style="display: none;">
                            <button type="button" id="select-screenshot-btn" class="btn-primary" disabled>
                                📷 スクリーンショットを選択（VALORANT未対応）
                            </button>
                            <div id="selected-file-info" class="file-info" style="display: none;">
                                <span id="file-name"></span>
                                <button type="button" id="clear-file-btn" class="btn-text">✕</button>
                            </div>
                        </div>

                        <div id="batch-preview-section" class="preview-section" style="display: none;">
                            <h4>📊 抽出されたデータ</h4>
                            <div id="batch-data-preview" class="data-preview">
                                抽出データがここに表示される
                            </div>
                            <div class="batch-actions">
                                <button type="button" id="save-batch-data-btn" class="btn-primary" disabled>
                                    💾 データを保存
                                </button>
                                <button type="button" id="cancel-batch-btn" class="btn-secondary" disabled>
                                    ❌ キャンセル
                                </button>
                            </div>
                        </div>

                        <div id="batch-loading" class="batch-loading" style="display: none;">
                            <div class="loading-spinner"></div>
                            <p>AIが画像を分析中...</p>
                        </div>
                    </div>-->
                </div>
                </div>

                <!-- Traditional Match Input (Collapsible) -->
                <div class="card detailed-match-card collapsed" id="detailed-match-card">
                    <div class="card-header collapsible-header" onclick="toggleDetailedInput()">
                        <h3>📝 詳細入力モード</h3>
                        <span class="collapse-icon">▼</span>
                    </div>
                    <div class="card-content">
                        <form id="match-form" class="match-form">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="match-result">勝敗</label>
                                    <select id="match-result" required>
                                        <option value="">選択してください</option>
                                        <option value="WIN">WIN</option>
                                        <option value="LOSS">LOSE</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="character-select">使用キャラクター</label>
                                    <select id="character-select" required>
                                        <option value="">キャラクターを選択</option>
                                        <option value="Luke">Luke</option>
                                        <option value="Ryu">Ryu</option>
                                        <option value="Ken">Ken</option>
                                        <option value="Chun-Li">Chun-Li</option>
                                        <option value="Cammy">Cammy</option>
                                        <option value="Zangief">Zangief</option>
                                        <option value="JP">JP</option>
                                        <option value="Juri">Juri</option>
                                        <option value="Kimberly">Kimberly</option>
                                        <option value="Lily">Lily</option>
                                        <option value="Manon">Manon</option>
                                        <option value="Marisa">Marisa</option>
                                        <option value="Jamie">Jamie</option>
                                        <option value="Dhalsim">Dhalsim</option>
                                        <option value="E.Honda">E.Honda</option>
                                        <option value="Blanka">Blanka</option>
                                        <option value="Guile">Guile</option>
                                        <option value="Dee Jay">Dee Jay</option>
                                        <option value="ラシード">ラシード</option>
                                        <option value="A.K.I.">A.K.I.</option>
                                        <option value="エド">エド</option>
                                        <option value="豪鬼">豪鬼</option>
                                        <option value="ベガ">ベガ</option>
                                        <option value="テリー・ボガード">テリー・ボガード</option>
                                        <option value="不知火 舞">不知火 舞</option>
                                        <option value="エレナ">エレナ</option>
                                        <option value="サガット">サガット</option>
                                        <option value="C.ヴァイパー">C.ヴァイパー</option>
                                        <option value="アレックス">アレックス</option>
                                        <option value="イングリッド">イングリッド</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="player-character">使用キャラクター（詳細）</label>
                                    <input type="text" id="player-character" placeholder="Luke">
                                </div>
                                <div class="form-group">
                                    <label for="opponent-character">相手キャラクター</label>
                                    <input type="text" id="opponent-character" placeholder="Ryu" required>
                                </div>
                                <div class="form-group">
                                    <label for="rounds-won">獲得ラウンド数</label>
                                    <input type="number" id="rounds-won" min="0" max="3" value="0" required>
                                </div>
                                <div class="form-group">
                                    <label for="rounds-lost">失ったラウンド数</label>
                                    <input type="number" id="rounds-lost" min="0" max="3" value="0" required>
                                </div>
                                <div class="form-group">
                                    <label for="match-duration">試合時間（分）</label>
                                    <input type="number" id="match-duration" min="1" step="0.1" value="3" required>
                                </div>
                            </div>

                            <!-- 詳細データ入力セクション -->
                            <div class="detailed-data-section">
                                <h4>詳細データ (オプション)</h4>
                                <div class="form-grid">
                                    <!-- ドライブシステム関連 -->
                                    <div class="form-group">
                                        <label for="drive-rush-count">ドライブラッシュ使用回数</label>
                                        <input type="number" id="drive-rush-count" min="0" value="0">
                                    </div>
                                    <div class="form-group">
                                        <label for="drive-impact-count">ドライブインパクト使用回数</label>
                                        <input type="number" id="drive-impact-count" min="0" value="0">
                                    </div>
                                    <div class="form-group">
                                        <label for="drive-reversal-count">ドライブリバーサル使用回数</label>
                                        <input type="number" id="drive-reversal-count" min="0" value="0">
                                    </div>
                                    <div class="form-group">
                                        <label for="overdrive-count">オーバードライブ技使用回数</label>
                                        <input type="number" id="overdrive-count" min="0" value="0">
                                    </div>

                                    <!-- 投げ関連 -->
                                    <div class="form-group">
                                        <label for="throw-attempts">投げ試行回数</label>
                                        <input type="number" id="throw-attempts" min="0" value="0">
                                    </div>
                                    <div class="form-group">
                                        <label for="throw-success">投げ成功回数</label>
                                        <input type="number" id="throw-success" min="0" value="0">
                                    </div>
                                    <div class="form-group">
                                        <label for="throw-escaped">投げ抜け回数</label>
                                        <input type="number" id="throw-escaped" min="0" value="0">
                                    </div>

                                    <!-- 必殺技・スーパーアーツ関連 -->
                                    <div class="form-group">
                                        <label for="special-moves-hit">必殺技ヒット数</label>
                                        <input type="number" id="special-moves-hit" min="0" value="0">
                                    </div>
                                    <div class="form-group">
                                        <label for="special-moves-blocked">必殺技ガード数</label>
                                        <input type="number" id="special-moves-blocked" min="0" value="0">
                                    </div>
                                    <div class="form-group">
                                        <label for="super-arts-used">スーパーアーツ使用回数</label>
                                        <input type="number" id="super-arts-used" min="0" value="0">
                                    </div>
                                    <div class="form-group">
                                        <label for="critical-arts-used">クリティカルアーツ使用回数</label>
                                        <input type="number" id="critical-arts-used" min="0" value="0">
                                    </div>

                                    <!-- 防御関連 -->
                                    <div class="form-group">
                                        <label for="perfect-parries">パーフェクトパリィ成功回数</label>
                                        <input type="number" id="perfect-parries" min="0" value="0">
                                    </div>
                                    <div class="form-group">
                                        <label for="parry-attempts">パリィ試行回数</label>
                                        <input type="number" id="parry-attempts" min="0" value="0">
                                    </div>
                                    <div class="form-group">
                                        <label for="burnout-count">バーンアウト回数</label>
                                        <input type="number" id="burnout-count" min="0" value="0">
                                    </div>

                                    <!-- コンボ関連 -->
                                    <div class="form-group">
                                        <label for="max-combo-hits">最大コンボヒット数</label>
                                        <input type="number" id="max-combo-hits" min="0" value="0">
                                    </div>
                                    <div class="form-group">
                                        <label for="combo-damage">最大コンボダメージ</label>
                                        <input type="number" id="combo-damage" min="0" value="0">
                                    </div>
                                    <div class="form-group">
                                        <label for="combo-dropped">コンボドロップ回数</label>
                                        <input type="number" id="combo-dropped" min="0" value="0">
                                    </div>
                                </div>
                            </div>

                            <button type="submit" class="btn-primary">分析を実行</button>
                        </form>
                    </div>
                </div>

                <!-- Analysis Results -->
                <div id="analysis-results" class="analysis-results hidden">
                    <!-- Analysis results will be populated here -->
                </div>
            </div>

            <!-- Gallery Page -->
            <div id="gallery" class="page">
                <div class="page-header">
                    <h2>🖼️ 試合ギャラリー</h2>
                    <p>記録された試合データの閲覧・管理</p>
                </div>

                <!-- フィルター・検索エリア -->
                <div class="card gallery-filters">
                    <div class="filter-header">
                        <h3>絞り込み・検索</h3>
                        <div class="selection-controls">
                            <button class="btn-secondary" id="toggle-selection-mode">
                                <span class="icon">✓</span> 削除
                            </button>
                        </div>
                    </div>
                    
                    <!-- 選択モード時の操作ボタン（初期非表示） -->
                    <div class="selection-actions hidden" id="selection-actions">
                        <div class="selection-info">
                            <span id="selection-count">0件選択中</span>
                        </div>
                        <div class="selection-buttons">
                            <button class="btn-secondary" id="select-all-btn">
                                <span class="icon">☑</span> すべて選択
                            </button>
                            <button class="btn-secondary" id="deselect-all-btn">
                                <span class="icon">☐</span> 選択解除
                            </button>
                            <button class="btn-danger" id="delete-selected-btn" disabled>
                                <span class="icon">🗑️</span> 選択項目を削除
                            </button>
                            <button class="btn-secondary" id="cancel-selection-btn">
                                <span class="icon">✕</span> キャンセル
                            </button>
                        </div>
                    </div>

                    <div class="filter-grid">
                        <div class="filter-group">
                            <label for="filter-opponent">対戦相手</label>
                            <select id="filter-opponent">
                                <option value="">すべて</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="filter-result">勝敗</label>
                            <select id="filter-result">
                                <option value="">すべて</option>
                                <option value="WIN">勝利のみ</option>
                                <option value="LOSS">敗北のみ</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="filter-tag">気づきタグ</label>
                            <input type="text" id="filter-tag" placeholder="タグで検索...">
                        </div>
                        <div class="filter-actions">
                            <button class="btn-primary" id="apply-filters">絞り込み</button>
                            <button class="btn-secondary" id="clear-filters">クリア</button>
                        </div>
                    </div>
                </div>

                <!-- 試合カード一覧 -->
                <div class="gallery-grid" id="gallery-grid">
                    <!-- カードはJavaScriptで動的に生成されます -->
                </div>
            </div>

            <!-- AI Chat Page -->
            <div id="ai-chat" class="page">
                <div class="page-header">
                    <h2>🤖 AIチャット</h2>
                    <p>Gemini AI とリアルタイムチャットしてゲームのアドバイスを受けよう</p>
                </div>

                <!-- Chat Interface -->
                <div class="card chat-container">
                    <div class="chat-header">
                        <h3>💬 チャット</h3>
                        <button id="clear-chat" class="btn-secondary">履歴クリア</button>
                    </div>
                    
                    <div class="chat-messages" id="chat-messages">
                        <div class="chat-message ai-message">
                            <div class="message-avatar">🤖</div>
                            <div class="message-content">
                                <div class="message-text">
                                    こんにちは！ゲーミングのパフォーマンス向上をお手伝いします。何でも聞いてください！
                                </div>
                                <div class="message-time">今</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chat-input-container">
                        <div class="chat-input-wrapper">
                            <textarea id="chat-input" placeholder="メッセージを入力..." rows="1"></textarea>
                            <button id="send-message" class="send-btn" disabled>
                                <span>📤</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Goals Page -->
            <div id="goals" class="page">
                <div class="page-header">
                    <h2>目標管理</h2>
                    <p>短期・長期目標の設定と進捗管理</p>
                </div>

                <!-- Add Goal Form -->
                <div class="card centered-button-card">
                    <h3>新しい目標を作成</h3>
                    <p class="subtitle">AIがあなたの目標達成をサポートする計画を作成します</p>
                    <div class="centered-button-wrapper">
                        <button type="button" id="create-with-plan-btn" class="btn-accent btn-large">📋 プラン付きで目標作成</button>
                    </div>
                </div>

                <!-- Goals List -->
                <div class="card">
                    <h3>現在の目標</h3>
                    <div id="goals-list" class="goals-list">
                        <!-- Goals will be populated here -->
                    </div>
                </div>

                <!-- Coaching Plan Modal -->
                <div id="coaching-plan-modal" class="modal hidden">
                    <div class="modal-content coaching-plan-modal">
                        <div class="modal-header">
                            <h3>📋 コーチングプラン作成（SF6最適化版）</h3>
                            <button class="modal-close" id="close-plan-modal">&times;</button>
                        </div>

                        <div class="modal-body">
                            <!-- VALORANT Knowledge Base Status -->
                            <div class="valorant-knowledge-status" id="valorant-knowledge-status">
                                <div class="knowledge-indicator">
                                    <span class="indicator-icon">📚</span>
                                    <div class="indicator-text">
                                        <span class="indicator-label">VALORANT知識ベース:</span>
                                        <span class="indicator-value" id="kb-status-text">確認中...</span>
                                    </div>
                                    <button class="btn-icon" id="reload-kb-btn" title="知識ベースを再読み込み">
                                        🔄
                                    </button>
                                </div>
                                <div class="knowledge-details hidden" id="kb-details">
                                    <div class="kb-info">
                                        <span>📄 ファイル数: <strong id="kb-file-count">0</strong></span>
                                        <span>📊 データサイズ: <strong id="kb-data-size">0</strong>文字</span>
                                    </div>
                                    <p class="kb-help-text">
                                        💡 データソースページでVALORANT攻略資料をアップロードすると、より精度の高いプランが生成されます
                                    </p>
                                </div>
                            </div>

                            <!-- Plan Generation Step -->
                            <div id="plan-generation-step" class="plan-step">
                                <div class="plan-summary">
                                    <h4>目標情報を入力</h4>
                                    <form id="modal-goal-form" class="modal-goal-form">
                                        <div class="form-group">
                                            <label for="modal-goal-title-input">目標タイトル <span class="required">*</span></label>
                                            <input type="text" id="modal-goal-title-input" placeholder="例：ダイヤモンドランク到達" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="modal-goal-deadline-input">期限 <span class="required">*</span></label>
                                            <input type="date" id="modal-goal-deadline-input" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="modal-goal-description-input">詳細説明（任意）</label>
                                            <textarea id="modal-goal-description-input" rows="3" placeholder="目標の詳細や達成したいことを記入してください"></textarea>
                                        </div>
                                    </form>
                                </div>

                                <div class="plan-generation">
                                    <div class="generation-status hidden" id="generation-status">
                                        <div class="loading-spinner"></div>
                                        <p>AIがあなた専用のコーチングプランを作成中...</p>
                                    </div>

                                    <div class="generation-buttons">
                                        <button id="generate-plan-btn" class="btn-primary">🤖 AIでプラン生成</button>
                                        <button id="manual-plan-btn" class="btn-secondary">✏️ 手動でプラン作成</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Plan Review Step -->
                            <div id="plan-review-step" class="plan-step hidden">
                                <div class="plan-preview">
                                    <h4>生成されたコーチングプラン</h4>
                                    <div class="plan-overview">
                                        <div class="plan-stats">
                                            <div class="plan-stat">
                                                <span class="stat-number" id="plan-total-weeks">0</span>
                                                <span class="stat-label">週間</span>
                                            </div>
                                            <div class="plan-stat">
                                                <span class="stat-number" id="plan-total-days">0</span>
                                                <span class="stat-label">日間</span>
                                            </div>
                                            <div class="plan-stat">
                                                <span class="stat-number">60</span>
                                                <span class="stat-label">分/日</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="weeks-container" id="weeks-container">
                                        <!-- 週別プランが表示される -->
                                    </div>
                                </div>

                                <div class="plan-actions">
                                    <button id="edit-plan-btn" class="btn-secondary">✏️ プランを編集</button>
                                    <button id="approve-plan-btn" class="btn-primary">✅ このプランで開始</button>
                                    <button id="regenerate-plan-btn" class="btn-outline">🔄 再生成</button>
                                </div>
                            </div>

                            <!-- Plan Edit Step -->
                            <div id="plan-edit-step" class="plan-step hidden">
                                <div class="plan-editor">
                                    <h4>プラン編集</h4>
                                    <div class="edit-weeks-container" id="edit-weeks-container">
                                        <!-- 編集可能な週別プラン -->
                                    </div>
                                </div>

                                <div class="edit-actions">
                                    <button id="save-plan-btn" class="btn-primary">💾 プランを保存</button>
                                    <button id="cancel-edit-btn" class="btn-secondary">キャンセル</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Settings Page -->
            <div id="settings" class="page">
                <div class="page-header">
                    <h2>⚙️ 設定</h2>
                    <p>プレイヤープロファイルとアプリケーション設定</p>
                </div>

                <!-- Player Profile Settings -->
                <div class="card">
                    <h3>プレイヤープロファイル</h3>
                    <div class="profile-settings">
                        <div class="current-profile" id="current-profile-display">
                            <div class="profile-info-section">
                                <div class="skill-info">
                                    <span class="skill-icon" id="current-skill-icon">📊</span>
                                    <div class="skill-details">
                                        <span class="skill-level" id="current-skill-level">中級者</span>
                                        <span class="skill-description" id="current-skill-description">バランスの取れたスキルレベル</span>
                                    </div>
                                </div>
                                <button id="change-skill-btn" class="btn-secondary">スキルレベルを変更</button>
                            </div>
                        </div>

                        <div id="skill-selector" class="skill-selector hidden">
                            <div class="skill-levels" id="skill-levels">
                                <div class="skill-option" data-skill="beginner">
                                    <div class="skill-option-icon">🌱</div>
                                    <div class="skill-option-content">
                                        <h4>初心者</h4>
                                        <p>基本的なゲームメカニクスを学習中</p>
                                    </div>
                                </div>
                                <div class="skill-option" data-skill="intermediate">
                                    <div class="skill-option-icon">📊</div>
                                    <div class="skill-option-content">
                                        <h4>中級者</h4>
                                        <p>ゲームの基本は理解し、上達を目指している</p>
                                    </div>
                                </div>
                                <div class="skill-option" data-skill="advanced">
                                    <div class="skill-option-icon">🏆</div>
                                    <div class="skill-option-content">
                                        <h4>上級者</h4>
                                        <p>高度な戦略と技術を身につけている</p>
                                    </div>
                                </div>
                            </div>
                            <div class="skill-selector-actions">
                                <button id="confirm-skill-btn" class="btn-primary">選択を確定</button>
                                <button id="cancel-skill-btn" class="btn-secondary">キャンセル</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Application Settings -->
                <div class="card">
                    <h3>アプリケーション設定</h3>
                    <div class="settings-list">
                        <div class="setting-item">
                            <label for="notifications">通知を有効にする</label>
                            <input type="checkbox" id="notifications" checked>
                        </div>
                        <div class="setting-item">
                            <label for="auto-analysis">自動分析を有効にする</label>
                            <input type="checkbox" id="auto-analysis">
                        </div>
                        <div class="setting-item">
                            <label for="data-retention">データ保持期間（日）</label>
                            <input type="number" id="data-retention" value="30" min="1" max="365">
                        </div>
                        <div class="setting-item">
                            <label>アプリの初期化</label>
                            <button id="reset-app-btn" class="btn-secondary">初期化する</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Coaching Plans Page -->
            <div id="coaching-plans" class="page">
                <div class="page-header">
                    <h2>📋 コーチングプラン</h2>
                    <p>現在のプランと進捗状況を確認</p>
                </div>

                <!-- Active Plans -->
                <div class="card">
                    <div class="card-header">
                        <h3>アクティブなプラン</h3>
                        <button id="refresh-plans-btn" class="btn-secondary">🔄 更新</button>
                    </div>
                    <div id="active-plans-container" class="plans-container">
                        <!-- Active plans will be displayed here -->
                    </div>
                </div>

                <!-- Current Week Details -->
                <div class="card" id="current-week-card" style="display: none;">
                    <h3>今週の内容</h3>
                    <div id="current-week-content" class="current-week-details">
                        <!-- Current week details will be displayed here -->
                    </div>
                </div>

                <!-- All Plans -->
                <div class="card">
                    <div class="card-header">
                        <h3>すべてのプラン</h3>
                        <div class="plan-filters">
                            <select id="plan-status-filter">
                                <option value="all">すべて</option>
                                <option value="active">アクティブ</option>
                                <option value="completed">完了</option>
                                <option value="paused">一時停止</option>
                                <option value="draft">下書き</option>
                            </select>
                        </div>
                    </div>
                    <div id="all-plans-container" class="plans-container">
                        <!-- All plans will be displayed here -->
                    </div>
                </div>
            </div>

            <!-- Data Source Page -->
            <div id="data-source" class="page">
                <div class="page-header">
                    <h2>📁 データソース管理</h2>
                    <p>AI分析の基になる情報ソースをアップロード・管理します</p>
                </div>

                <!-- File Upload Card -->
                <div class="card">
                    <h3>新しいソースをアップロード</h3>
                    <form id="upload-form" class="upload-form">
                        <div class="form-group">
                            <label for="file-input">ファイルを選択</label>
                            <input type="file" id="file-input" name="file" accept=".txt,.md,.json,.csv,.docx" required>
                            <p class="subtitle">対応形式: .txt, .md, .json, .csv, .docx. (最大5MB)</p>
                        </div>
                        <button type="submit" id="upload-btn" class="btn-primary" disabled>アップロード</button>
                    </form>
                    <div id="upload-progress-container" style="display: none; margin-top: 15px;">
                        <div class="progress-bar">
                            <div id="upload-progress-bar" class="progress-fill" style="width: 0%;"></div>
                        </div>
                        <span id="upload-progress-text">0%</span>
                    </div>
                </div>

                <!-- Uploaded Files List Card -->
                <div class="card">
                    <h3>アップロード済みソース一覧</h3>
                    <div id="data-source-list" class="data-source-list">
                        <div class="no-files-message">
                            <p>まだアップロードされたファイルがありません。</p>
                        </div>
                        <!-- File list will be populated here -->
                    </div>
                </div>
            </div>
        </main>

        <!-- Loading Overlay -->
        <div id="loading" class="loading-overlay hidden">
            <div class="loading-content">
                <div class="spinner"></div>
                <p>分析中...</p>
            </div>
        </div>

        <!-- Toast Messages -->
        <div id="toast-container" class="toast-container"></div>

        <!-- Login Modal -->
        <div id="login-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>e-Bridge</h2>
                    <p>ログインまたは新規登録</p>
                </div>
                
                <div class="tabs">
                    <button class="tab-btn active" data-tab="login">ログイン</button>
                    <button class="tab-btn" data-tab="register">新規登録</button>
                </div>
                
                <div id="login-tab" class="tab-content active">
                    <form id="login-form">
                        <div class="form-group">
                            <label for="login-username">ユーザー名</label>
                            <input type="text" id="login-username" required>
                        </div>
                        <div class="form-group">
                            <label for="login-password">パスワード</label>
                            <input type="password" id="login-password" required>
                        </div>
                        <button type="submit" class="btn-primary">ログイン</button>
                    </form>
                </div>
                
                <div id="register-tab" class="tab-content">
                    <form id="register-form">
                        <div class="form-group">
                            <label for="register-username">ユーザー名</label>
                            <input type="text" id="register-username" required>
                        </div>
                        <div class="form-group">
                            <label for="register-email">メールアドレス</label>
                            <input type="email" id="register-email" required>
                        </div>
                        <div class="form-group">
                            <label for="register-password">パスワード</label>
                            <input type="password" id="register-password" required>
                        </div>
                        <div class="form-group">
                            <label for="register-password-confirm">パスワード（確認）</label>
                            <input type="password" id="register-password-confirm" required>
                        </div>
                        <button type="submit" class="btn-primary">登録</button>
                    </form>
                </div>
                
                <div class="modal-divider">
                    <span>または</span>
                </div>
                
                <div class="guest-access">
                    <button id="guest-btn" class="btn-guest">ゲストとして使用する</button>
                    <p class="guest-note">※ データは保存されません</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Loading Overlay -->
    <div id="loading" class="loading-overlay hidden">
        <div class="loading-content">
            <div class="spinner"></div>
            <p>処理中...</p>
        </div>
    </div>

    <!-- API Initial Setup Modal -->
    <div id="api-initial-setup-modal" class="modal api-setup-priority">
        <div class="modal-overlay"></div>
        <div class="modal-content api-setup-content">
            
            <!-- Header -->
            <div class="setup-header">
                <div class="logo-section">
                    <h1>🌉 e-Bridge</h1>
                    <p class="tagline">AI-Powered eSports Performance Bridge</p>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="setup-body">
                <div class="setup-title">
                    <h2>🔑 APIキー初期設定</h2>
                    <p>e-BridgeのAI機能を使用するには、Gemini APIキーが必要です</p>
                </div>
                
                <!-- API Key Input Area -->
                <div class="api-input-section">
                    <label for="initial-api-key">Gemini APIキー</label>
                    <div class="input-wrapper">
                        <input type="password" 
                               id="initial-api-key" 
                               placeholder="APIキーを入力"
                               autocomplete="off">
                        <button id="toggle-initial-key" class="eye-btn">👁️</button>
                    </div>
                    <div class="input-helper">
                        <p>APIキーは一度設定すれば、すべてのAI機能で共通使用されます</p>
                    </div>
                </div>
                
                <!-- Feature Information -->
                <div class="features-info">
                    <h3>利用可能になる機能：</h3>
                    <div class="feature-list">
                        <div class="feature-item">
                            <span class="feature-icon">💬</span>
                            <div>
                                <strong>AIチャット</strong>
                                <p>パーソナライズされたコーチング</p>
                                <small class="model-info">Gemini 2.5 Flash</small>
                            </div>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">🎯</span>
                            <div>
                                <strong>目標別アドバイス</strong>
                                <p>目標に応じた具体的な提案</p>
                                <small class="model-info">Gemini 2.5 Flash</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="setup-actions">
                    <button id="test-initial-api" class="btn-secondary">
                        接続テスト
                    </button>
                    <button id="save-initial-api" class="btn-primary" disabled>
                        設定を保存して開始
                    </button>
                </div>
                
                <!-- API Key Help -->
                <div class="api-help">
                    <p>APIキーをお持ちでない方は</p>
                    <a href="https://makersuite.google.com/app/apikey" 
                       target="_blank" 
                       class="api-link">
                        Google AI Studioで無料取得 →
                    </a>
                </div>
                
                <!-- Error Help -->
                <div class="error-help" style="display: none; margin-top: 15px; padding: 10px; background-color: var(--error-bg, #fee); border: 1px solid var(--error-border, #fcc); border-radius: 4px; color: var(--error-text, #c33);">
                    接続テストでエラーが発生しました
                </div>
                
                <!-- Skip Option -->
                <div class="skip-option">
                    <button id="skip-api-setup" class="btn-text">
                        後で設定する（一部機能制限）
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Initial Setup Modal (Game & Skill Selection) -->
    <div id="initial-setup-modal" class="modal initial-setup-priority">
        <div class="modal-overlay"></div>
        <div class="modal-content initial-setup-content">

            <!-- Header -->
            <div class="setup-header">
                <div class="logo-section">
                    <h1>🌉 e-Bridge</h1>
                    <p class="tagline">AI-Powered eSports Performance Bridge</p>
                </div>
                <div class="setup-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="setup-progress-fill"></div>
                    </div>
                    <span class="progress-text" id="setup-progress-text">ステップ 1 / 1</span>
                </div>
            </div>

            <!-- Step 1: Skill Level Selection -->
            <div class="setup-step" id="setup-step-1">
                <div class="step-content">
                    <div class="step-title">
                        <h2>📊 スキルレベルを選択</h2>
                        <p>現在のスキルレベルを正直に選択してください</p>
                    </div>

                    <div class="skill-grid" id="setup-skill-grid">
                        <div class="skill-card" data-skill="beginner">
                            <div class="skill-icon">🌱</div>
                            <h3>初心者</h3>
                            <p>基本的なゲームメカニクスを学習中</p>
                            <ul class="skill-features">
                                <li>基本操作の習得</li>
                                <li>ルール理解</li>
                                <li>基礎練習</li>
                            </ul>
                        </div>
                        <div class="skill-card" data-skill="intermediate">
                            <div class="skill-icon">📊</div>
                            <h3>中級者</h3>
                            <p>ゲームの基本は理解し、上達を目指している</p>
                            <ul class="skill-features">
                                <li>戦略理解</li>
                                <li>応用テクニック</li>
                                <li>チームプレイ</li>
                            </ul>
                        </div>
                        <div class="skill-card" data-skill="advanced">
                            <div class="skill-icon">🏆</div>
                            <h3>上級者</h3>
                            <p>高度な戦略と技術を身につけている</p>
                            <ul class="skill-features">
                                <li>メタ理解</li>
                                <li>高度な戦術</li>
                                <li>コーチング視点</li>
                            </ul>
                        </div>
                    </div>

                    <div class="step-actions">
                        <button id="setup-skill-complete" class="btn-primary" disabled>
                            設定完了
                        </button>
                    </div>
                </div>
            </div>

            <!-- Completion Step -->
            <div class="setup-step hidden" id="setup-step-complete">
                <div class="step-content completion-content">
                    <div class="completion-icon">🎉</div>
                    <h2>設定完了！</h2>
                    <p>あなたのプロフィールが設定されました</p>

                    <div class="profile-summary">
                        <div class="summary-item">
                            <span class="summary-label">選択ゲーム:</span>
                            <span class="summary-value" id="summary-game">VALORANT</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">スキルレベル:</span>
                            <span class="summary-value" id="summary-skill">中級者</span>
                        </div>
                    </div>

                    <div class="next-steps">
                        <h3>これからできること：</h3>
                        <div class="feature-preview">
                            <div class="preview-item">
                                <span class="preview-icon">🎯</span>
                                <div>
                                    <strong>日替わりコーチング</strong>
                                    <p>毎日パーソナライズされたアドバイス</p>
                                </div>
                            </div>
                            <div class="preview-item">
                                <span class="preview-icon">📈</span>
                                <div>
                                    <strong>パフォーマンス分析</strong>
                                    <p>詳細な試合データ分析</p>
                                </div>
                            </div>
                            <div class="preview-item">
                                <span class="preview-icon">🤖</span>
                                <div>
                                    <strong>AIチャット</strong>
                                    <p>リアルタイムでの質問と回答</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="step-actions">
                        <button id="setup-start-app" class="btn-primary btn-large">
                            e-Bridgeを開始する
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Match Detail Modal -->
    <div id="match-detail-modal" class="modal hidden">
        <div class="modal-overlay" onclick="app.closeMatchDetailModal()"></div>
        <div class="modal-content match-detail-content">
            <div class="modal-header">
                <h2>試合詳細</h2>
                <button class="modal-close" onclick="app.closeMatchDetailModal()">✕</button>
            </div>

            <div class="match-detail-body" id="match-detail-body">
                <!-- 詳細はJavaScriptで動的に生成されます -->
            </div>

            <div class="match-detail-actions">
                <button class="btn-secondary" onclick="app.closeMatchDetailModal()">閉じる</button>
                <button class="btn-primary" id="edit-match-btn">✏️ 編集</button>
                <button class="btn-danger" id="delete-match-btn">🗑️ 削除</button>
            </div>
        </div>
    </div>

    <!-- Plan Detail Modal -->
    <div id="plan-detail-modal" class="modal hidden">
        <div class="modal-overlay" onclick="app.closePlanDetailModal()"></div>
        <div class="modal-content plan-detail-content">
            <div class="modal-header">
                <h2 id="plan-detail-title">プラン詳細</h2>
                <button class="modal-close" onclick="app.closePlanDetailModal()">✕</button>
            </div>

            <div class="plan-detail-body">
                <!-- プラン概要 -->
                <div class="plan-overview">
                    <div class="plan-meta">
                        <div class="meta-item">
                            <span class="meta-label">目標</span>
                            <span class="meta-value" id="detail-goal-title">-</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">ステータス</span>
                            <span class="meta-value" id="detail-plan-status">-</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">総週数</span>
                            <span class="meta-value" id="detail-total-weeks">-</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">進捗</span>
                            <span class="meta-value" id="detail-progress">-</span>
                        </div>
                    </div>

                    <div class="plan-progress-section">
                        <div class="progress-bar">
                            <div class="progress-fill" id="detail-progress-bar"></div>
                        </div>
                    </div>
                </div>

                <!-- 現在週の詳細 -->
                <div class="current-week-section">
                    <h3>📅 現在週の詳細</h3>
                    <div class="current-week-card" id="detail-current-week">
                        <!-- 動的に生成 -->
                    </div>
                </div>

                <!-- 週別プラン一覧 -->
                <div class="weeks-timeline">
                    <h3>📋 週別プラン</h3>
                    <div class="timeline-container" id="detail-weeks-timeline">
                        <!-- 動的に生成 -->
                    </div>
                </div>
            </div>

            <div class="plan-detail-actions">
                <button class="btn-secondary" onclick="app.closePlanDetailModal()">閉じる</button>
                <button class="btn-accent" id="detail-edit-plan-btn" onclick="app.editPlanFromDetail()">プランを編集</button>
                <div class="plan-status-actions">
                    <button class="btn-warning" id="detail-pause-plan-btn" onclick="app.pausePlanFromDetail()">一時停止</button>
                    <button class="btn-success" id="detail-resume-plan-btn" onclick="app.resumePlanFromDetail()">再開</button>
                    <button class="btn-primary" id="detail-complete-plan-btn" onclick="app.completePlanFromDetail()">完了</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Win Rate Detail Modal -->
    <div id="winrate-detail-modal" class="modal hidden">
        <div class="modal-overlay" onclick="app.closeWinRateDetailModal()"></div>
        <div class="modal-content winrate-detail-content">
            <div class="modal-header">
                <h2>📊 対戦キャラクター別勝率詳細</h2>
            </div>

            <div class="modal-body">
                <!-- 統計サマリー -->
                <div class="stats-summary">
                    <div class="summary-stat">
                        <span class="summary-label">総試合数</span>
                        <span class="summary-value" id="detail-total-matches">0</span>
                    </div>
                    <div class="summary-stat">
                        <span class="summary-label">対戦キャラ数</span>
                        <span class="summary-value" id="detail-unique-opponents">0</span>
                    </div>
                    <div class="summary-stat">
                        <span class="summary-label">全体勝率</span>
                        <span class="summary-value" id="detail-overall-winrate">0%</span>
                    </div>
                </div>

                <!-- ソート・フィルター -->
                <div class="detail-controls">
                    <div class="control-group">
                        <label for="sort-by">並び替え:</label>
                        <select id="sort-by" class="sort-select">
                            <option value="matches-desc">対戦回数（多い順）</option>
                            <option value="matches-asc">対戦回数（少ない順）</option>
                            <option value="winrate-desc">勝率（高い順）</option>
                            <option value="winrate-asc">勝率（低い順）</option>
                            <option value="name-asc">キャラ名（A-Z）</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="min-matches">最小試合数:</label>
                        <input type="number" id="min-matches" min="0" value="0" class="filter-input">
                    </div>
                </div>

                <!-- キャラクター別勝率リスト -->
                <div class="opponent-stats-list" id="opponent-stats-list">
                    <!-- JavaScriptで動的に生成 -->
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-secondary" onclick="app.closeWinRateDetailModal()">閉じる</button>
                <button class="btn-primary" onclick="app.exportWinRateData()">📥 データをエクスポート</button>
            </div>
        </div>
    </div>

    <!-- Coaching History Modal -->
    <div id="modal-overlay" class="modal-overlay" style="display: none;"></div>
    <div id="history-modal" class="history-modal" style="display: none;">
        <div class="history-modal-header">
            <h3>📜 コーチング履歴</h3>
            <button id="close-modal-button" class="close-modal-btn">✕</button>
        </div>
        <div class="history-modal-body">
            <div class="history-search-section">
                <input type="text" id="search-history-input" class="search-history-input" placeholder="キーワードで検索...">
                <span class="search-icon">🔍</span>
            </div>
            <div id="history-list-container" class="history-list-container">
                <!-- 履歴がここに表示されます -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Chrome拡張機能のエラーを完全に抑制
        (function() {
            // エラーイベントをキャプチャ
            const originalError = console.error;
            console.error = function(...args) {
                const message = args.join(' ');
                if (message.includes('message port closed') || 
                    message.includes('message channel closed') ||
                    message.includes('runtime.lastError')) {
                    return; // 拡張機能関連のエラーは無視
                }
                originalError.apply(console, args);
            };
            
            // グローバルエラーハンドラー
            window.addEventListener('error', function(e) {
                if (e.message && (
                    e.message.includes('message channel closed') ||
                    e.message.includes('message port closed') ||
                    e.message.includes('runtime.lastError')
                )) {
                    e.preventDefault();
                    e.stopPropagation();
                    return true;
                }
            }, true);
            
            // Promise rejectionエラーハンドラー
            window.addEventListener('unhandledrejection', function(e) {
                if (e.reason && e.reason.message && 
                    (e.reason.message.includes('message channel closed') || 
                     e.reason.message.includes('message port closed') ||
                     e.reason.message.includes('runtime.lastError'))) {
                    e.preventDefault();
                    e.stopPropagation();
                    return true;
                }
            }, true);
        })();
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.11.0/mammoth.browser.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="mock-data.js"></script>
    <script src="api-service.js"></script>
    <script src="auth-service.js"></script>
    <script src="game-categories.js"></script>
    <script src="theme-manager.js"></script>
    <script src="unified-api-manager.js"></script>
    <script src="gemini-service.js"></script>
    <script src="coaching-service.js"></script>
    <script src="coaching-plan-service.js"></script>
    <script src="app.js"></script>
</body>
</html>