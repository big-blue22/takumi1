# 📸 まとめて入力機能 - 実装完了

## 概要
Street Fighter 6の戦績画面のスクリーンショットをアップロードすると、AIが自動的にキャラクター別の試合数と勝率を抽出して保存する機能を実装しました。

## 実装内容

### 1. **gemini-service.js** - 画像分析機能
- `analyzeMatchImage(imageFile)`: Gemini APIを使用して画像からデータを抽出
- `fileToBase64(file)`: 画像をBase64形式に変換
- 両方の形式に対応:
  - 形式1: 「試合数」と「勝率%」（例: 33戦, 54.55%）
  - 形式2: 「勝利数/試合数」（例: 14勝/23戦）

### 2. **index.html** - UIの追加
- 「まとめて入力（スクリーンショット）」セクションを追加
- 詳細入力モードの上に配置
- 以下のUIコンポーネント:
  - ファイル選択ボタン
  - データプレビューテーブル
  - 保存/キャンセルボタン
  - ローディングインジケーター

### 3. **app.js** - 機能ロジック
新しいメソッド:
- `setupBatchInputListeners()`: イベントリスナーの設定
- `handleScreenshotUpload(file)`: スクリーンショットアップロード処理
- `displayBatchDataPreview(matches)`: 抽出データのプレビュー表示
- `saveBatchMatchData()`: データをローカルストレージに保存
- `clearBatchInput()`: 入力フォームをクリア

### 4. **styles.css** - スタイリング
- バッチ入力カードのスタイル
- データテーブルのスタイル
- ローディングスピナー
- レスポンシブデザイン対応

## 使い方

### 1. APIキーの設定
まず、Gemini APIキーが設定されていることを確認してください。

### 2. スクリーンショットの準備
以下のような戦績画面のスクリーンショットを撮影:
- SF6の「BATTLE LOG」タブ
- キャラクター別対戦数と勝率が表示されている画面

### 3. アップロード
1. 「分析」タブに移動
2. 「まとめて入力（スクリーンショット）」セクションで「📷 スクリーンショットを選択」をクリック
3. 画像ファイルを選択
4. AIが自動的に画像を分析してデータを抽出

### 4. 確認と保存
1. 抽出されたデータがテーブルで表示されます
2. データを確認
3. 「💾 データを保存」ボタンをクリック
4. ダッシュボードが自動的に更新されます

## データ形式

### 抽出されるデータ
```json
{
  "matches": [
    {
      "character": "KIMBERLY",
      "totalMatches": 33,
      "winRate": 54.55,
      "wins": 18
    },
    {
      "character": "ZANGIEF",
      "totalMatches": 33,
      "winRate": 69.70,
      "wins": 23
    }
  ]
}
```

### 保存形式
各キャラクターの勝敗が個別の試合データとしてギャラリーに保存されます:
- 勝利試合: 勝利数分の`WIN`エントリー
- 敗北試合: 敗北数分の`LOSS`エントリー
- タグ: `#一括入力`が自動付与

## 対応画像形式
- PNG, JPG, JPEG, WebP
- 推奨サイズ: 5MB以下

## テスト画像
以下の画像でテストできます:
- `c:\Users\tie-p\Downloads\2025-09-22_15.50.26.png`
- `c:\Users\tie-p\Downloads\2025-09-22_15.49.29.png`

## 注意事項
1. **APIキーが必要**: Gemini APIキーが設定されていない場合、エラーが表示されます
2. **画像の品質**: 画像が不鮮明だとAIが正しく読み取れない可能性があります
3. **ALL/全体データ**: 「ALL」や「全体」という名前のキャラクターデータは自動的にスキップされます
4. **対戦相手情報**: スクリーンショットからは対戦相手情報が取得できないため、「Unknown」として記録されます

## トラブルシューティング

### 画像が分析できない
- 画像の形式を確認（PNG/JPGが推奨）
- 画像サイズを確認（5MB以下）
- APIキーが正しく設定されているか確認

### データが正しく抽出されない
- 画像の品質を確認
- SF6の戦績画面のスクリーンショットであることを確認
- キャラクター名や数値が明瞭に見えるか確認

### 保存できない
- ブラウザのローカルストレージが有効か確認
- コンソールでエラーメッセージを確認

## 今後の拡張案
- [ ] 複数画像の一括アップロード
- [ ] 対戦相手情報の抽出（可能な場合）
- [ ] 日付情報の抽出
- [ ] プログレスバーの追加
- [ ] ドラッグ&ドロップ対応

## 実装ファイル
1. `gemini-service.js` - 画像分析API
2. `app.js` - アプリケーションロジック
3. `index.html` - UI構造
4. `styles.css` - スタイリング
