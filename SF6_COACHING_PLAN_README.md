# ストリートファイター6 コーチングプラン生成システム

## 📋 概要

このシステムは、ストリートファイター6（SF6）に特化したAI駆動のコーチングプラン生成機能です。ユーザーの目標、スキルレベル、プレイ統計、そして保存されたSF6攻略資料を活用し、最新のメタ情報を参照しながら、個別最適化された週単位の練習プランを自動生成します。

## 🎯 主な機能

### 1. SF6知識ベースの自動読み込み
- **データソース自動検出**: LocalStorageに保存されたSF6攻略資料を自動的に読み込み
- **サイズ制限管理**: 12,000文字までのデータを効率的に活用
- **リアルタイム更新**: 知識ベースの状態をUIでリアルタイム表示
- **手動リロード**: ボタンクリックで最新データを再読み込み可能

### 2. グラウンディング（Web検索）機能
- **Google検索統合**: Gemini APIのGoogle Search Grounding機能を使用
- **SF6固有の検索クエリ生成**:
  - 最新メタ情報（2025年対応）
  - キャラクター別攻略情報
  - スキルレベル別上達法
  - ランクマッチ攻略
  - 対策情報

### 3. プレイヤー統計の活用
自動的に以下の統計情報を分析してプラン生成に反映：
- 総試合数と総合勝率
- よく使うキャラクター（上位3つ）
- 苦手な相手キャラクター（勝率が低い相手）

### 4. SF6専用プロンプト設計
生成されるプランには以下のSF6固有要素を含む：
- **ドライブシステム**: パリィ、ラッシュ、インパクト、リバーサル
- **操作方式**: モダン/クラシック対応
- **キャラクター固有要素**: コンボルート、セットプレイ
- **対戦知識**: フレーム有利・不利、受け身狩り
- **最新パッチ**: 2025年の変更点を考慮

## 🔄 システムフロー

```
┌─────────────────────────────────────────────┐
│ 1. ユーザーが目標を設定                        │
│    - 目標タイトル（例：ダイヤランク到達）       │
│    - 期限（例：4週間後）                       │
│    - キャラクター、説明（オプション）           │
└────────────────┬────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────┐
│ 2. SF6知識ベースの自動読み込み                 │
│    - LocalStorageからデータソースを取得        │
│    - サイズ確認（最大12,000文字）              │
│    - コンテキストに組み込み                    │
└────────────────┬────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────┐
│ 3. プレイヤー統計情報の取得                    │
│    - ギャラリーデータから分析                  │
│    - 勝率、使用キャラ、苦手相手を抽出          │
└────────────────┬────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────┐
│ 4. SF6専用検索クエリの生成                     │
│    - 最新メタ情報検索                          │
│    - キャラクター固有検索                      │
│    - スキルレベル別検索                        │
└────────────────┬────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────┐
│ 5. Gemini APIでプラン生成                      │
│    - Google Search Grounding有効化            │
│    - SF6知識ベースをコンテキストに含める       │
│    - 最新Web情報を参照                         │
└────────────────┬────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────┐
│ 6. 週別プランの構造化                          │
│    - 第1段階: 日付ベースの枠組み作成           │
│    - 第2段階: AIによる内容生成                │
│    - マージ: 完全なプランオブジェクト作成      │
└────────────────┬────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────┐
│ 7. UI表示とメタデータ保存                      │
│    - 週別カード表示                            │
│    - グラウンディングソース表示                │
│    - LocalStorageに保存                       │
└─────────────────────────────────────────────┘
```

## 📊 データ構造

### プランオブジェクト
```javascript
{
  id: "plan_1728888888888",
  goalId: "goal_1728888888888",
  goalTitle: "ダイヤモンドランク到達",
  createdAt: "2025-10-13T00:00:00.000Z",
  updatedAt: "2025-10-13T00:00:00.000Z",
  status: "draft", // draft, active, completed, paused
  weeks: [
    {
      weekNumber: 1,
      startDate: "2025-10-13",
      endDate: "2025-10-19",
      focus: "ドライブシステムの基礎とパリィ練習",
      objectives: [
        "トレーニングモードでパリィを20回連続成功",
        "ランクマッチでドライブラッシュを5回以上使用",
        "ドライブゲージの管理を意識して10試合"
      ],
      milestones: [
        "パリィ成功率60%以上",
        "ドライブラッシュからコンボ完走3回",
        "ゲージ切れ0回で5試合完了"
      ]
    }
    // ... 他の週
  ],
  metadata: {
    gameGenre: "fighting",
    skillLevel: "intermediate",
    totalWeeks: 4,
    estimatedTimePerDay: 60,
    knowledgeBaseUsed: true, // 知識ベース使用有無
    groundingSources: {      // グラウンディング情報
      searchPerformed: ["ストリートファイター6 最新メタ 2025"],
      sources: [
        {
          title: "SF6 2025年最新メタ解説",
          url: "https://example.com/sf6-meta",
          snippet: "2025年のSF6メタは..."
        }
      ],
      totalSources: 5
    }
  }
}
```

## 🎮 使用方法

### 1. データソースの準備
1. **データソースページ**に移動
2. SF6攻略資料（テキストファイル）をアップロード
   - キャラクター別コンボ表
   - フレームデータ
   - 対策メモ
   - パッチノート
3. データは自動的にLocalStorageに保存される

### 2. 目標作成とプラン生成
1. **目標ページ**で「プラン付きで作成」をクリック
2. 目標情報を入力：
   - タイトル（例：「リュウでプラチナランク到達」）
   - 期限（例：4週間後）
   - 説明（オプション）
3. **知識ベースの状態を確認**
   - 「📚 SF6知識ベース: 有効」と表示されていればOK
   - 「🔄」ボタンで最新状態に更新可能
4. 「🤖 AIでプラン生成」をクリック
5. 生成されたプランを確認・編集
6. 「✅ このプランで開始」で承認

### 3. プランの実行
- **コーチングプランページ**でアクティブなプランを確認
- 週ごとの進捗を追跡
- 必要に応じてプランを調整

## 🔧 技術仕様

### API連携
- **Gemini API**: `gemini-2.0-flash-exp`モデル使用
- **Google Search Grounding**: Web検索機能統合
- **レート制限**: 自動的に管理

### データ管理
- **LocalStorage**: プラン、目標、データソースを保存
- **自動クリーンアップ**: 古いキャッシュを定期削除

### エラーハンドリング
- API接続失敗時のフォールバック
- JSON解析エラー時の自動修復
- 不完全なレスポンスの補完

## 📈 最適化ポイント

### 1. プロンプトの最適化
- SF6固有の用語を使用
- 測定可能な目標設定
- 実践的な練習内容

### 2. コンテキストの効率化
- 知識ベースのサイズ制限（12,000文字）
- 関連性の高い情報を優先
- 最新情報を検索で補完

### 3. ユーザー体験の向上
- リアルタイム状態表示
- 直感的なUI
- 詳細なフィードバック

## 🚀 今後の拡張可能性

1. **キャラクター別テンプレート**: 各キャラクターに特化したプラン
2. **ランク別最適化**: 現在のランクから目標ランクへの段階的プラン
3. **動画リソース連携**: YouTube動画などの参考資料リンク
4. **コミュニティ共有**: 効果的なプランを他のユーザーと共有
5. **進捗分析**: AI による定期的なプラン調整提案

## 📝 注意事項

- API使用量に応じて料金が発生します
- Web検索機能は利用可能な地域が限定される場合があります
- データソースは個人利用の範囲内で使用してください
- 最新パッチ情報は定期的に更新することを推奨します

## 🆘 トラブルシューティング

### 知識ベースが読み込まれない
- データソースページでファイルが正しくアップロードされているか確認
- ブラウザのLocalStorageが有効か確認
- 「🔄」ボタンで手動リロードを試す

### プラン生成が失敗する
- APIキーが正しく設定されているか確認
- インターネット接続を確認
- しばらく待ってから再試行（レート制限の可能性）

### グラウンディング情報が表示されない
- Gemini APIのGoogle Search Grounding機能が有効か確認
- プロンプトに検索キーワードが含まれているか確認
- API応答にgroundingMetadataが含まれているかログで確認

---

**開発日**: 2025年10月13日  
**バージョン**: 1.0.0  
**対応ゲーム**: ストリートファイター6
