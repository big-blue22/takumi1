# Gemini API 修正テストガイド

## 📝 このガイドについて

このガイドでは、Gemini APIの404/503エラー修正が正しく適用されているかを確認する方法を説明します。

## ✅ 修正内容の確認

### 1. コード変更の確認

```bash
# gemini-service.jsでモデル名を確認
grep "this.chatModel" gemini-service.js
# 期待される出力: this.chatModel = 'gemini-1.5-flash-latest';

# 2.5モデルへの参照がないことを確認
grep "gemini-2.5" gemini-service.js
# 期待される出力: （何も表示されない）
```

### 2. ブラウザでの動作確認

#### ステップ1: アプリケーションを開く
1. `index.html` をブラウザで開く
2. 開発者ツール（F12）を開き、コンソールタブを表示

#### ステップ2: APIキーを設定
1. 設定画面またはAPIキー入力欄を開く
2. 有効なGemini APIキーを入力（AIzaで始まる）

#### ステップ3: 接続テストを実行
1. 「API接続テスト」または類似のボタンをクリック
2. コンソールで以下を確認:
   ```
   🔄 Gemini API接続テスト中...
   🎯 試行モデル: gemini-1.5-flash-latest
   ✅ Gemini API接続テスト成功! 使用モデル: gemini-1.5-flash-latest
   ```

#### ステップ4: エラーがないことを確認
コンソールで以下のエラーが**表示されない**ことを確認:
```
❌ 404エラー: API エンドポイントが見つかりません
❌ 503エラー: Service Unavailable
```

### 3. 機能テスト

#### AIチャット機能
1. AIチャット画面を開く
2. 任意のメッセージを送信（例: "こんにちは"）
3. AIからの応答が正常に返ってくることを確認

#### タグ生成機能
1. 気づきやメモの入力画面を開く
2. テキストを入力してタグ生成を実行
3. タグが正常に生成されることを確認

## 🔍 トラブルシューティング

### 404エラーが依然として発生する場合

#### 原因1: キャッシュの問題
```javascript
// ブラウザコンソールで実行
localStorage.clear();
location.reload(true); // 強制リロード
```

#### 原因2: ファイルが更新されていない
```bash
# 修正版のファイルを確認
git log --oneline -3
# "Fix Gemini API model names from 2.5 to 1.5" が含まれていることを確認

# 最新のファイルを取得
git pull origin <ブランチ名>
```

#### 原因3: 古いバージョンのファイルが読み込まれている
- ブラウザのキャッシュをクリア（Ctrl+Shift+Delete）
- シークレットモード/プライベートブラウジングで開く

### APIキーのエラーが発生する場合

#### エラー: "APIキーが無効"
- Google AI Studio でAPIキーの有効性を確認
- APIキーの前後にスペースがないことを確認
- 正しいプロジェクトのAPIキーを使用しているか確認

#### エラー: "クォータ超過"
- Google Cloud Console でAPIの使用状況を確認
- 無料プランの制限に達している可能性

## 📊 期待される動作

### 正常な動作フロー

1. **接続テスト開始**
   ```
   🔄 Gemini API接続テスト中...
   🔑 APIキー: AIzaSyCXhH...
   🎯 試行モデル: gemini-1.5-flash-latest
   ```

2. **API呼び出し成功**
   ```
   📡 API Response: { status: 200, statusText: "OK" }
   ✅ API Request successful
   ```

3. **接続テスト完了**
   ```
   ✅ Gemini API接続テスト成功! 使用モデル: gemini-1.5-flash-latest
   ```

### エラーが発生する場合の動作

修正後も以下のエラーが表示される場合は、別の問題がある可能性があります:

#### ネットワークエラー
```
❌ ネットワーク接続に失敗しました
```
→ インターネット接続を確認

#### 認証エラー
```
❌ APIキーが無効か、権限がありません (401/403)
```
→ APIキーを確認、Google Cloud Console で API を有効化

#### レート制限
```
❌ レート制限に達しました (429)
```
→ 時間をおいて再試行

## 🎯 成功の確認

すべての機能が正常に動作する場合、以下が達成されています:

- ✅ 404エラーが解消されている
- ✅ 503エラーが解消されている
- ✅ `gemini-1.5-flash-latest` モデルで接続できている
- ✅ AIチャット機能が正常に動作
- ✅ タグ生成機能が正常に動作

## 📞 サポート

問題が解決しない場合:
1. `GEMINI_API_FIX_REPORT.md` を確認
2. ブラウザのコンソールログを収集
3. GitHub Issues で報告

---

**最終更新**: 2024-11-17
**対応バージョン**: Gemini 1.5 Flash
